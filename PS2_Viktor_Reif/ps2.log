--------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\fx236\Documents\impact_eval\Impact_Eval\PS2_Viktor_Reif\ps2.log
  log type:  text
 opened on:  18 Dec 2021, 16:11:27

. use "namelist.dta", clear

. //browse // I use browse to get familiar with the data...
. use "schoolvar.dta"

. //browse
. 
. 
. *** b)
. use "namelist.dta", clear

. // I assume every child in the datset had the first visit in 1998
. keep if visit==981
(521,880 observations deleted)

. 
. 
. *** c)
. //duplicates drop pupid, force  would also work
. keep if dupid==1
(11 observations deleted)

. duplicates report pupid

Duplicates in terms of pupid

--------------------------------------
   Copies | Observations       Surplus
----------+---------------------------
        1 |        34781             0
--------------------------------------

. 
. *** d)
. merge 1:1 pupid using "pupq.dta"

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,425
        from master                    19,728  (_merge==1)
        from using                        697  (_merge==2)

    Matched                            15,053  (_merge==3)
    -----------------------------------------

. 
. *** e) i)
. gen absent_share = absdays_98_6/20
(22,500 missing values generated)

. 
. *** e) ii)
. // I assume often sick only holds if value is "often ". "Sometime" does not count.
. gen often_sick = 0

. replace often_sick=1 if fallsick_98_37==3
(1,239 real changes made)

. *** e) iii)
. // I assume "a bit dirty" does not count as clean.
. gen clean = 0

. replace clean=1 if clean_98_15==1
(8,434 real changes made)

. 
. *** f)
. //collapse converts the dataset in memory into a dataset of means, sums, medians, etc. clist must refer to numeric variables exclusively
. //collapse absent_share bloodst_98_58 often_sick malaria_98_48 clean 
. collapse sex elg98 stdgap yrbirth wgrp* absent_share bloodst_98_58 often_sick malaria_98_48 clean (count) number_pupils=pupid, by (schid) 

. bys wgrp: summ sex elg98 stdgap yrbirth absent_share bloodst_98_58 often_sick malaria_98_48 clean [aweight=number_pupils] 

--------------------------------------------------------------------------------------------------------------------------------------------------------
-> wgrp = 1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         sex |      25       11634    .5329346   .0274165   .4649681        .58
       elg98 |      25       11634     .885874   .0247304   .8320313   .9418604
      stdgap |      25       11634   -1.972535   .2533046  -2.605882  -1.580786
     yrbirth |      25       11634    1986.193   .5321102   1985.276   1987.464
absent_share |      25       11634    .0268141   .0143407   .0030488   .0727273
-------------+-----------------------------------------------------------------
bloodst_9~58 |      25       11634     .263413   .1181527    .097561   .5207373
  often_sick |      25       11634    .0375623   .0200634          0   .0721831
malaria_9~48 |      25       11634     .363305   .0907609   .2184466   .5669292
       clean |      25       11634     .232852   .0669412   .0569395    .379845

--------------------------------------------------------------------------------------------------------------------------------------------------------
-> wgrp = 2

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         sex |      25       11990    .5096775   .1047777   .0200893   .5714286
       elg98 |      25       11990    .8919381   .0248131   .8363096          1
      stdgap |      25       11990   -1.821623   .3942747  -2.539063  -.7777778
     yrbirth |      25       11990    1986.543   .6206054   1985.349   1988.789
absent_share |      25       11990      .03754   .0166282          0   .0814103
-------------+-----------------------------------------------------------------
bloodst_9~58 |      25       11990    .2286574    .102837          0         .5
  often_sick |      25       11990    .0326105   .0137128          0   .0662651
malaria_9~48 |      25       11990     .386183   .1060229          0        .75
       clean |      25       11990    .2181818   .0850787          0   .4135802

--------------------------------------------------------------------------------------------------------------------------------------------------------
-> wgrp = 3

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         sex |      25       11157    .5221049   .0213989   .4585635   .5606061
       elg98 |      25       11157    .8842065   .0199719        .84   .9104478
      stdgap |      25       11157   -1.969827    .335163  -2.612903  -1.384921
     yrbirth |      25       11157    1985.787   .5752325   1984.777   1986.964
absent_share |      25       11157    .0305107   .0083628   .0189796   .0584507
-------------+-----------------------------------------------------------------
bloodst_9~58 |      25       11157    .1958594   .1233425   .0873362    .754717
  often_sick |      25       11157    .0303845   .0177939   .0042194    .084507
malaria_9~48 |      25       11157    .4023663   .1006871   .2297297   .6994535
       clean |      25       11157    .2517702   .0686931   .1386364   .3622449

--------------------------------------------------------------------------------------------------------------------------------------------------------
-> wgrp = .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         sex |       0           0
       elg98 |       0           0
      stdgap |       0           0
     yrbirth |       0           0
absent_share |       1         697    .0321663          .   .0321663   .0321663
-------------+-----------------------------------------------------------------
bloodst_9~58 |       1         697    .2619048          .   .2619048   .2619048
  often_sick |       1         697    .1032999          .   .1032999   .1032999
malaria_9~48 |       1         697    .3852814          .   .3852814   .3852814
       clean |       1         697    .4304161          .   .4304161   .4304161


. 
. *** g)
. foreach var in sex elg98 stdgap yrbirth absent_share bloodst_98_58 often_sick malaria_98_48 { 
  2.         regress `var' wgrp1 wgrp2 [aweight=number_pupils] 
  3.                 } 
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.83
       Model |  .006902472         2  .003451236   Prob > F        =    0.4423
    Residual |  .301166511        72  .004182868   R-squared       =    0.0224
-------------+----------------------------------   Adj R-squared   =   -0.0047
       Total |  .308068983        74  .004163094   Root MSE        =    .06468

------------------------------------------------------------------------------
         sex | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |   .0108297   .0184553     0.59   0.559    -.0259602    .0476197
       wgrp2 |  -.0124275   .0183207    -0.68   0.500    -.0489491    .0240941
       _cons |   .5221049   .0131857    39.60   0.000     .4958197    .5483902
------------------------------------------------------------------------------
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.77
       Model |  .000836175         2  .000418088   Prob > F        =    0.4680
    Residual |  .039223479        72  .000544771   R-squared       =    0.0209
-------------+----------------------------------   Adj R-squared   =   -0.0063
       Total |  .040059654        74  .000541347   Root MSE        =    .02334

------------------------------------------------------------------------------
       elg98 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |   .0016674   .0066603     0.25   0.803    -.0116095    .0149444
       wgrp2 |   .0077316   .0066117     1.17   0.246    -.0054485    .0209117
       _cons |   .8842065   .0047585   185.81   0.000     .8747206    .8936925
------------------------------------------------------------------------------
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      1.71
       Model |  .379184076         2  .189592038   Prob > F        =    0.1887
    Residual |  7.99815463        72  .111085481   R-squared       =    0.0453
-------------+----------------------------------   Adj R-squared   =    0.0187
       Total |  8.37733871        74   .11320728   Root MSE        =    .33329

------------------------------------------------------------------------------
      stdgap | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |   -.002708    .095107    -0.03   0.977    -.1923004    .1868843
       wgrp2 |   .1482046   .0944133     1.57   0.121    -.0400049     .336414
       _cons |  -1.969827   .0679509   -28.99   0.000    -2.105285    -1.83437
------------------------------------------------------------------------------
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =     10.66
       Model |  7.11572947         2  3.55786474   Prob > F        =    0.0001
    Residual |  24.0209652        72  .333624517   R-squared       =    0.2285
-------------+----------------------------------   Adj R-squared   =    0.2071
       Total |  31.1366947        74  .420766144   Root MSE        =     .5776

------------------------------------------------------------------------------
     yrbirth | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |   .4060469   .1648211     2.46   0.016     .0774821    .7346118
       wgrp2 |   .7554463   .1636189     4.62   0.000      .429278    1.081615
       _cons |   1985.787   .1177594  1.7e+04   0.000     1985.552    1986.022
------------------------------------------------------------------------------
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      4.06
       Model |  .001514702         2  .000757351   Prob > F        =    0.0213
    Residual |  .013430992        72  .000186542   R-squared       =    0.1013
-------------+----------------------------------   Adj R-squared   =    0.0764
       Total |  .014945694        74  .000201969   Root MSE        =    .01366

------------------------------------------------------------------------------
absent_share | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |  -.0036966   .0038974    -0.95   0.346    -.0114659    .0040726
       wgrp2 |   .0070293   .0038689     1.82   0.073    -.0006833    .0147419
       _cons |   .0305107   .0027845    10.96   0.000     .0249598    .0360616
------------------------------------------------------------------------------
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      2.13
       Model |  .056092187         2  .028046094   Prob > F        =    0.1268
    Residual |  .950063668        72  .013195329   R-squared       =    0.0557
-------------+----------------------------------   Adj R-squared   =    0.0295
       Total |  1.00615585        74  .013596701   Root MSE        =    .11487

------------------------------------------------------------------------------
bloodst_9~58 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |   .0675536   .0327789     2.06   0.043     .0022101    .1328971
       wgrp2 |    .032798   .0325398     1.01   0.317    -.0320689    .0976649
       _cons |   .1958594   .0234195     8.36   0.000     .1491736    .2425453
------------------------------------------------------------------------------
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      1.11
       Model |   .00066776         2   .00033388   Prob > F        =    0.3354
    Residual |  .021674565        72  .000301036   R-squared       =    0.0299
-------------+----------------------------------   Adj R-squared   =    0.0029
       Total |  .022342325        74  .000301923   Root MSE        =    .01735

------------------------------------------------------------------------------
  often_sick | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |   .0071778    .004951     1.45   0.151    -.0026918    .0170474
       wgrp2 |    .002226   .0049149     0.45   0.652    -.0075716    .0120236
       _cons |   .0303845   .0035373     8.59   0.000      .023333    .0374361
------------------------------------------------------------------------------
(sum of wgt is 34,781)

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.96
       Model |  .018977189         2  .009488594   Prob > F        =    0.3877
    Residual |  .711537399        72  .009882464   R-squared       =    0.0260
-------------+----------------------------------   Adj R-squared   =   -0.0011
       Total |  .730514588        74  .009871819   Root MSE        =    .09941

------------------------------------------------------------------------------
malaria_9~48 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       wgrp1 |  -.0390614   .0283672    -1.38   0.173    -.0956103    .0174876
       wgrp2 |  -.0161833   .0281603    -0.57   0.567    -.0723198    .0399532
       _cons |   .4023663   .0202675    19.85   0.000     .3619639    .4427688
------------------------------------------------------------------------------

. 
. *** h)
. clear

. use "schoolvar.dta"

. bys wgrp: summ mk96_s distlake pup_pop latr_pup z_inf98 pop1_3km_updated pop1_36k_updated popT_3km_updated popT_36k_updated 

--------------------------------------------------------------------------------------------------------------------------------------------------------
-> wgrp = 1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      mk96_s |         25   -.1965843    .7253123  -2.092469   1.007758
    distlake |         25    10.03356    5.425798          0     19.381
     pup_pop |         25      392.72    158.3297        148        748
    latr_pup |         24    .0074168    .0033881   .0022779   .0142857
     z_inf98 |         25    .3688953    .1058442   .2206897   .5326461
-------------+---------------------------------------------------------
pop1_3km_u~d |         25     430.386     419.985          0   1518.213
pop1_36k_u~d |         25    1157.599    728.8401          0   2877.282
popT_3km_u~d |         25    1272.716    779.7018   208.7699   2975.706
popT_36k_u~d |         25    3431.257    1292.692   831.3265   6275.649

--------------------------------------------------------------------------------------------------------------------------------------------------------
-> wgrp = 2

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      mk96_s |         25    .1753381    .9622502  -1.600851   2.214684
    distlake |         24    9.922959    8.116067          0     24.742
     pup_pop |         25       403.8    275.6167         14       1351
    latr_pup |         22    .0061782     .003619   .0007402   .0144928
     z_inf98 |         25    .3665191    .1005379   .2206897   .5326461
-------------+---------------------------------------------------------
pop1_3km_u~d |         25    433.1711    436.5513          0   1548.964
pop1_36k_u~d |         25    1042.968    575.6648          0   2032.465
popT_3km_u~d |         25    1369.087    752.7977          0   3023.563
popT_36k_u~d |         25    3259.787    1064.051   1112.049   5772.801

--------------------------------------------------------------------------------------------------------------------------------------------------------
-> wgrp = 3

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      mk96_s |         25    .0212462    .7800998  -1.074894   2.850376
    distlake |         25     9.45548    6.399379       .355     21.956
     pup_pop |         25      375.88    153.5291         95        675
    latr_pup |         24    .0065807    .0033304   .0015291   .0140845
     z_inf98 |         25     .360046    .1078718   .2206897   .5326461
-------------+---------------------------------------------------------
pop1_3km_u~d |         25    344.5075    372.9133          0   1265.049
pop1_36k_u~d |         25    1297.344    791.6159          0   2977.748
popT_3km_u~d |         25    1151.869    670.2877          0   3053.657
popT_36k_u~d |         25    3502.098    1489.969   1117.238   5845.649


. // regress `var' wgrp  does not work because stata does not understand categorical variables. I use dummies but omit category 3
. gen wgrp_1 = (wgrp==1) 

. gen wgrp_2 = (wgrp==2) 

. foreach var in mk96_s distlake pup_pop latr_pup z_inf98 pop1_3km_updated pop1_36k_updated popT_3km_updated popT_36k_updated { 
  2.                         regress `var' wgrp_1 wgrp_2 
  3.                 } 

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      1.27
       Model |   1.7460065         2  .873003252   Prob > F        =    0.2868
    Residual |   49.453421        72  .686853069   R-squared       =    0.0341
-------------+----------------------------------   Adj R-squared   =    0.0073
       Total |  51.1994275        74  .691884155   Root MSE        =    .82877

------------------------------------------------------------------------------
      mk96_s | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |  -.2178306   .2344104    -0.93   0.356    -.6851192     .249458
      wgrp_2 |   .1540919   .2344104     0.66   0.513    -.3131968    .6213805
       _cons |   .0212462   .1657532     0.13   0.898    -.3091767    .3516692
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        74
-------------+----------------------------------   F(2, 71)        =      0.05
       Model |  4.69353615         2  2.34676807   Prob > F        =    0.9494
    Residual |  3204.41479        71  45.1326026   R-squared       =    0.0015
-------------+----------------------------------   Adj R-squared   =   -0.0267
       Total |  3209.10832        73   43.960388   Root MSE        =    6.7181

------------------------------------------------------------------------------
    distlake | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |     .57808    1.90016     0.30   0.762    -3.210731    4.366892
      wgrp_2 |   .4674786   1.919851     0.24   0.808    -3.360596    4.295553
       _cons |    9.45548   1.343616     7.04   0.000     6.776386    12.13457
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.12
       Model |     9882.32         2     4941.16   Prob > F        =    0.8880
    Residual |  2990497.68        72    41534.69   R-squared       =    0.0033
-------------+----------------------------------   Adj R-squared   =   -0.0244
       Total |     3000380        74  40545.6757   Root MSE        =     203.8

------------------------------------------------------------------------------
     pup_pop | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |      16.84   57.64352     0.29   0.771    -98.07025    131.7503
      wgrp_2 |      27.92   57.64352     0.48   0.630    -86.99025    142.8303
       _cons |     375.88   40.76012     9.22   0.000     294.6262    457.1338
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        70
-------------+----------------------------------   F(2, 67)        =      0.78
       Model |  .000018548         2  9.2739e-06   Prob > F        =    0.4614
    Residual |  .000794177        67  .000011853   R-squared       =    0.0228
-------------+----------------------------------   Adj R-squared   =   -0.0063
       Total |  .000812725        69  .000011779   Root MSE        =    .00344

------------------------------------------------------------------------------
    latr_pup | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |   .0008362   .0009939     0.84   0.403    -.0011476      .00282
      wgrp_2 |  -.0004025   .0010162    -0.40   0.693    -.0024308    .0016259
       _cons |   .0065807   .0007028     9.36   0.000     .0051779    .0079834
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.05
       Model |  .001048818         2  .000524409   Prob > F        =    0.9534
    Residual |  .790732524        72  .010982396   R-squared       =    0.0013
-------------+----------------------------------   Adj R-squared   =   -0.0264
       Total |  .791781342        74  .010699748   Root MSE        =     .1048

------------------------------------------------------------------------------
     z_inf98 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |   .0088493    .029641     0.30   0.766     -.050239    .0679377
      wgrp_2 |   .0064732    .029641     0.22   0.828    -.0526152    .0655615
       _cons |    .360046   .0209594    17.18   0.000     .3182642    .4018277
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.38
       Model |  127034.137         2  63517.0686   Prob > F        =    0.6876
    Residual |    12144691        72  168676.265   R-squared       =    0.0104
-------------+----------------------------------   Adj R-squared   =   -0.0171
       Total |  12271725.2        74  165834.124   Root MSE        =     410.7

------------------------------------------------------------------------------
pop1_3km_u~d | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |    85.8785   116.1641     0.74   0.462    -145.6904    317.4474
      wgrp_2 |   88.66354   116.1641     0.76   0.448    -142.9054    320.2325
       _cons |   344.5075   82.14043     4.19   0.000     180.7636    508.2515
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.82
       Model |  811462.173         2  405731.086   Prob > F        =    0.4457
    Residual |  35742084.1        72  496417.835   R-squared       =    0.0222
-------------+----------------------------------   Adj R-squared   =   -0.0050
       Total |  36553546.3        74  493966.842   Root MSE        =    704.57

------------------------------------------------------------------------------
pop1_36k_u~d | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |  -139.7451   199.2823    -0.70   0.485    -537.0071    257.5169
      wgrp_2 |  -254.3752   199.2823    -1.28   0.206    -651.6371    142.8868
       _cons |   1297.344   140.9139     9.21   0.000     1016.437     1578.25
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.55
       Model |  592290.514         2  296145.257   Prob > F        =    0.5810
    Residual |  38974198.8        72  541308.317   R-squared       =    0.0150
-------------+----------------------------------   Adj R-squared   =   -0.0124
       Total |  39566489.4        74  534682.289   Root MSE        =    735.74

------------------------------------------------------------------------------
popT_3km_u~d | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |   120.8462   208.0977     0.58   0.563     -293.989    535.6814
      wgrp_2 |   217.2178   208.0977     1.04   0.300    -197.6174     632.053
       _cons |   1151.869   147.1473     7.83   0.000     858.5365    1445.202
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        75
-------------+----------------------------------   F(2, 72)        =      0.23
       Model |  776122.937         2  388061.469   Prob > F        =    0.7937
    Residual |   120558315        72  1674421.04   R-squared       =    0.0064
-------------+----------------------------------   Adj R-squared   =   -0.0212
       Total |   121334438        74  1639654.56   Root MSE        =      1294

------------------------------------------------------------------------------
popT_36k_u~d | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      wgrp_1 |  -70.84051   365.9968    -0.19   0.847    -800.4419    658.7608
      wgrp_2 |  -242.3105   365.9968    -0.66   0.510    -971.9119    487.2908
       _cons |   3502.098   258.7988    13.53   0.000     2986.191    4018.004
------------------------------------------------------------------------------

. 
. *** i)
. 
. 
. *** j)
. 
. 
. 
. 
. 
. 
. 
end of do-file

